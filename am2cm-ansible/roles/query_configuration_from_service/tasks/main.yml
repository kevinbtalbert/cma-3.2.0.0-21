- name: Query configuration from Service
  query_configuration_value:
    cm_configuration: "{{ cm_configuration_dictionary }}"
    service_name: "{{ service_name }}"
    configuration_name: "{{ configuration_name }}"
    configuration_type: "{{ configuration_type | default(omit) }}"
    role_name_filter: "{{ role_name_filter | default(omit) }}"
  register: response
  delegate_to: localhost
  run_once: True
  changed_when: False

- name: Escaping output variable name
  set_fact:
    output_variable_name: "{{ configuration_name | regex_replace('[^a-zA-Z0-9_]','_') }}"

- name: Assigning value to output variable
  set_fact:
    "{{ output_variable_name }}": "{{ response.message }}"

- name: Print created fact
  debug:
    msg:
      - "Name of the service that the configuration was queried from: '{{ service_name }}'"
      - "Fact named '{{ output_variable_name }}' is now available and it's value is '{{ vars[output_variable_name] }}'"
  delegate_to: localhost
  run_once: True
